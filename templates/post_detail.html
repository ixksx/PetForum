{% extends 'base.html' %}

{% block title %}{{ post.author.username }} - {{ post.content|truncatechars:50 }}{% endblock %}

{% block content %}
<div class="post-detail-container">
    <div class="post-detail-card" id="post-{{ post.id }}">
        <div class="post-header">
            <a href="{% url 'profile' post.author.username %}" class="post-author">
                {% if post.author.avatar %}
                    <img src="{{ post.author.avatar.url }}" alt="{{ post.author.username }}" class="avatar">
                {% else %}
                    <div style="width: 56px; height: 56px; border-radius: 50%; background: var(--primary-color); color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;">
                        {{ post.author.username|first|upper }}
                    </div>
                {% endif %}
                <div>
                    <div style="font-weight: 700; font-size: 1.1rem;">{{ post.author.username }}</div>
                    <div style="font-size: 0.85rem; color: var(--text-light);">
                        {% if post.author.is_online %}
                        <span style="color: var(--success-color);">● Онлайн</span>
                        {% else %}
                        <span style="color: var(--text-light);">○ Был(а) {{ post.author.last_seen|timesince }} назад</span>
                        {% endif %}
                    </div>
                </div>
            </a>
            <span class="post-date">{{ post.created_at|date:"d M Y, H:i" }}</span>
        </div>

        <div class="post-content">
            <p>{{ post.content|linebreaks }}</p>
            {% if post.image %}
                <img src="{{ post.image.url }}" alt="Изображение поста" class="post-image-large">
            {% endif %}
        </div>

        <div class="post-actions">
            {% if user.is_authenticated %}
                <button class="like-btn" data-post-id="{{ post.id }}" data-action="like">
                    <img src="/static/images/like.svg"> <span class="like-count">{{ post.likes_count }}</span>
                </button>
                <button class="dislike-btn" data-post-id="{{ post.id }}" data-action="dislike">
                    <img src="/static/images/dislike.svg"> <span class="dislike-count">{{ post.dislikes_count }}</span>
                </button>
            {% else %}
                <button class="like-btn disabled" onclick="window.location.href='/login/'">
                    <img src="/static/images/like.svg"> {{ post.likes_count }}
                </button>
                <button class="dislike-btn disabled" onclick="window.location.href='/login/'">
                    <img src="/static/images/dislike.svg"> {{ post.dislikes_count }}
                </button>
            {% endif %}
        </div>
    </div>

    <div class="comments-section">
        <h3>Комментарии ({{ comments.count }})</h3>

        {% if user.is_authenticated %}
        <div class="add-comment">
            <form method="post" class="comment-form">
                {% csrf_token %}
                {{ form.content }}
                <button type="submit" class="btn btn-primary" style="margin-top: 1rem;">
                    Добавить комментарий
                </button>
            </form>
        </div>
        {% else %}
        <div class="login-prompt" style="background: rgba(255, 107, 139, 0.1); padding: 1.5rem; border-radius: 12px; text-align: center; margin-bottom: 2rem;">
            <p style="margin: 0; color: var(--text-color);">
                <a href="{% url 'login' %}?next={{ request.path }}" style="color: var(--primary-color); font-weight: 600;">Войдите</a>,
                чтобы оставлять комментарии
            </p>
        </div>
        {% endif %}

        <div class="comments-list">
            {% for comment in comments %}
            <div class="comment">
                <div class="comment-header">
                    <a href="{% url 'profile' comment.author.username %}" class="comment-author">
                        {{ comment.author.username }}
                    </a>
                    <span class="comment-date">{{ comment.created_at|date:"d.m.Y H:i" }}</span>
                </div>
                <div class="comment-content">
                    <p>{{ comment.content|linebreaks }}</p>
                </div>
            </div>
            {% empty %}
            <div class="no-comments" style="text-align: center; padding: 3rem 2rem;">
                <div style="font-size: 3rem; margin-bottom: 1rem;"></div>
                <h4 style="color: var(--text-light);">Комментариев пока нет</h4>
                <p style="color: var(--text-light);">Будьте первым, кто оставит комментарий!</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
